// @koala-append 'modules/facebookInit.js';
// @koala-append 'assets/facebook.js';
// @koala-append 'modules/twitterInit.js';

// @koala-append 'modules/header.js';
// @koala-append 'modules/toggle-fixed.js';
// @koala-append 'modules/sync-scroll.js';
// @koala-append 'modules/nav-to-comments.js';
// @koala-append 'modules/data-img.js';


// This function runs after Facebook is initiated //
var facebookInit = function(FB){
    
    var fbshare = $('.fb-share');
    fbshare.off().on({click: function(e){
        e.preventDefault();
        var t = $(e.target),
            previewParent = t.parents('.featured-article'),
            shareUrl;
        
        if (previewParent.length){shareUrl = previewParent.find('a.post-header').attr('href');}
        else{shareUrl = window.location.href;}
        
        
        
        FB.ui({
            method: 'share',
            href: shareUrl,
            display: 'iframe'
        });
    }});
    

}

window.fbAsyncInit = function() {
    FB.init({
      appId      : '1500566816925880',
      xfbml      : true,
      version    : 'v2.4'
    });
    
    if(typeof facebookInit === 'function'){
        facebookInit(FB);
    }
    
  };

(function(d, s, id){
 var js, fjs = d.getElementsByTagName(s)[0];
 if (d.getElementById(id)) {return;}
 js = d.createElement(s); js.id = id;
 js.src = "//connect.facebook.net/en_US/sdk.js";
 fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));


function popupwindow(url, title, w, h) {
  var left = (screen.width/2)-(w/2);
  var top = (screen.height/2)-(h/2) - 200;
  return window.open(url, title, 'toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width='+w+', height='+h+', top='+top+', left='+left);
} 

$(function(){
    var twitterInit = function(){
        var twitterBtn = $('.tw-share');
        twitterBtn.off().on({
            click : function(e){
                e.preventDefault();
                var t = $(e.target);
                popupwindow(t.attr('href'), 'tweet', 500, 300);
            }
        
        });   

    }
    twitterInit();
});

$(function(){

	$('.hamburger').on({

		click:function(e){
			e.preventDefault();
			if($('body').hasClass('menu-out')){
				$('body').removeClass('menu-out');
			}

			else{
				$('body').addClass('menu-out');
			}

		}
	});

});


$(function(){

	if($('.site-top-nav').length > 0){

		$(window).on({
			scroll: function(){

				if($(window).scrollTop() > $('.site-top-nav').height()){
					$('body').addClass('fixed');
				}

				else{
					$('body').removeClass('fixed');
				}
			},

		});
	}
	else{
		$('body').addClass('fixed');
	}
});


$(function(){if($('.site-nav').length){

    var lastScrollTop = 0,
        fancyScroll = $('.site-nav');

    $(window).on('scroll', function () {


        var st = $(this).scrollTop(),
            diff = st - lastScrollTop,
            scrollStop = $(window).innerHeight() + $(window).scrollTop(),
            fancyHeight = fancyScroll.offset().top + fancyScroll.innerHeight(),
            fancyScrollAmount = fancyScroll.scrollTop() + diff;

		if($('body').hasClass('fixed')){

			fancyScroll.scrollTop(fancyScrollAmount);


		}

		else{
			fancyScroll.scrollTop(0);
		}

		lastScrollTop = st;
    });

}});


$(function(){
    
    commentsInit = function(){
        
        var commentsBtn = $('.comment-link');
        commentsBtn.off().on({
            click : function(e){
                 e.preventDefault();
                
                var t = $(e.target),
                    previewParent = t.parents('.featured-article');
                
                    if(previewParent.length){
                        
                        var url = previewParent.children('a.post-header').attr('href') + '#comments'; 
                        window.location.href = url;
                    }
                else{
                    $('html,body').scrollTop(0).animate({scrollTop : $('#comments').offset().top},1200);
                }
            }
        
        });   
    }
    
    if(window.location.hash === '#comments'){
        $('html,body').scrollTop(0).animate({scrollTop : $('#comments').offset().top},1200);
    }

    commentsInit();
});

// Load images into placeholders
// Use data-bg="" on any element to async load an image background
// Use data-src="" on images to async load an image src


var loadDataImages = function(){
    
    // For each background placeholder
    $('[data-bg]').each(function(e){
        
            // grab 'this', the data-bg attribute and make a new placeholder image object
            var $img = $(this),
                $imgSrc = $(this).attr('data-bg'),
                $imgPlaceholder = new Image();
            
            // render background into local storage by applying it to the placeholder
            $imgPlaceholder.src = $imgSrc;
            
            // When the placeholder is loaded
            $imgPlaceholder.onload = function(){
                
                // Apply the source to 'this', hide 'this' and fade it in
                $img.removeAttr('data-bg').css({
                    opacity:0,
                    backgroundImage: 'url('+$imgSrc+')',
                }).animate({opacity:1},200);
            };
        });
        
    
        // Basically same thing with images
        
        
        $('img[data-src]').each(function(e){
            
            var $img = $(this),
                $imgSrc = $(this).attr('data-src'),
                $imgPlaceholder = new Image();
            
            $imgPlaceholder.src = $imgSrc;
            $imgPlaceholder.onload = function(){
                $img.css({opacity:0}).removeAttr('data-src').attr('src',$imgSrc).animate({opacity:1},200);
            };
        });


}

// Run on load (and use in other scripts as needed)
$(window).on('load',function(){
    loadDataImages();
});